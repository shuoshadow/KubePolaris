---
sidebar_position: 7
---

# 日志中心

KubePolaris 提供集中的日志查看功能，支持实时日志流、历史日志查询和日志下载。

## 日志类型

| 类型 | 来源 | 功能 |
|------|------|------|
| **容器日志** | Pod 容器标准输出 | 实时查看、历史查询 |
| **事件日志** | Kubernetes Events | 资源事件查看 |
| **审计日志** | KubePolaris 操作 | 操作审计记录 |

## 容器日志

### 查看单个 Pod 日志

1. 进入 Pod 详情页
2. 点击 **日志** 标签
3. 选择容器（多容器 Pod）
4. 查看日志内容

### 日志选项

| 选项 | 说明 |
|------|------|
| **容器** | 选择要查看的容器 |
| **Previous** | 查看上次运行的容器日志 |
| **行数** | 显示最新 N 行 |
| **时间范围** | 查看指定时间段的日志 |
| **时间戳** | 是否显示时间戳 |
| **自动刷新** | 实时跟踪新日志 |

### 实时日志

开启实时模式查看日志流：

1. 启用 **自动刷新** 开关
2. 日志自动滚动到最新
3. 点击 **暂停** 可停止滚动查看历史

### 日志搜索

使用搜索功能过滤日志：

1. 输入搜索关键字
2. 支持正则表达式
3. 高亮匹配内容

```
# 搜索示例
error
ERROR|WARN
"connection refused"
```

### 日志下载

导出日志文件：

1. 点击 **下载** 按钮
2. 选择时间范围
3. 选择格式（Text/JSON）
4. 下载文件

## 日志聚合

### 工作负载日志

查看工作负载下所有 Pod 的聚合日志：

1. 进入工作负载详情
2. 点击 **日志** 标签
3. 查看所有 Pod 的合并日志
4. 使用 Pod 选择器筛选

### 多 Pod 日志

同时查看多个 Pod 的日志：

1. 在 Pod 列表选择多个 Pod
2. 点击 **聚合日志**
3. 日志按时间排序合并
4. 不同 Pod 使用不同颜色标识

## 事件查看

### 集群事件

查看集群级别事件：

1. 进入集群详情 → **事件**
2. 按类型筛选：
   - Normal（正常）
   - Warning（警告）
3. 按资源类型筛选
4. 按时间范围筛选

### 资源事件

在各资源详情页查看相关事件：

- Pod 事件
- Deployment 事件
- Node 事件
- PVC 事件

### 事件信息

| 字段 | 说明 |
|------|------|
| Type | 事件类型（Normal/Warning） |
| Reason | 事件原因 |
| Object | 相关资源 |
| Message | 事件描述 |
| Count | 发生次数 |
| First Seen | 首次发生时间 |
| Last Seen | 最后发生时间 |

## 审计日志

### 查看审计日志

在 **审计日志** 页面查看操作记录：

| 字段 | 说明 |
|------|------|
| 时间 | 操作时间 |
| 用户 | 操作用户 |
| IP | 来源 IP |
| 操作 | 操作类型 |
| 资源 | 目标资源 |
| 结果 | 成功/失败 |
| 详情 | 详细信息 |

### 筛选条件

- 时间范围
- 用户
- 操作类型
- 资源类型
- 结果状态

### 导出审计日志

导出审计记录用于合规审查：

1. 设置筛选条件
2. 点击 **导出**
3. 选择格式（CSV/Excel）
4. 下载文件

## 日志配置

### 日志保留

在 **系统设置** 配置日志保留策略：

```yaml
logs:
  # 审计日志保留天数
  audit_retention_days: 90
  
  # 操作日志保留天数
  operation_retention_days: 30
```

### 日志级别

配置后端日志级别：

```yaml
log:
  level: info  # debug, info, warn, error
  format: json
```

## 常见问题

### 日志不显示

1. 检查容器是否在运行
2. 检查容器是否有日志输出
3. 检查权限设置

```bash
# 验证日志输出
kubectl logs <pod-name> -c <container-name>
```

### 日志截断

日志可能因以下原因截断：

1. 行数限制（默认 5000 行）
2. 大小限制
3. 时间范围限制

调整查询参数获取更多日志。

### 日志乱码

确保应用日志输出为 UTF-8 编码。

### 历史日志丢失

Kubernetes 默认只保留一定量的日志：

- 日志轮转配置
- 容器重启后日志丢失
- 建议使用日志收集系统长期保存

## 最佳实践

### 结构化日志

应用应输出结构化日志：

```json
{
  "timestamp": "2026-01-07T10:00:00Z",
  "level": "info",
  "message": "Request processed",
  "request_id": "abc-123",
  "duration_ms": 150,
  "status": 200
}
```

### 日志级别规范

| 级别 | 用途 |
|------|------|
| ERROR | 需要立即处理的错误 |
| WARN | 潜在问题，需要关注 |
| INFO | 重要业务事件 |
| DEBUG | 调试信息（生产环境关闭） |

### 敏感信息

避免在日志中输出敏感信息：
- 密码
- Token
- 个人信息
- 证书内容

### 日志收集

生产环境建议使用专业的日志收集方案：
- ELK Stack（Elasticsearch + Logstash + Kibana）
- Loki + Grafana
- Fluentd + Elasticsearch
- 云厂商日志服务

## 下一步

- [权限管理](./rbac-permissions) - RBAC 配置
- [管理员指南](../admin-guide/deployment) - 部署运维

